<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
    <th:block th:include="fragment/header"></th:block>
    <!-- Content Wrapper -->
    <div id="content-wrapper" class="d-flex flex-column">

      <!-- Main Content -->
      <div id="content">
        <th:block th:include="fragment/nav"></th:block>

        <!-- Begin Page Content -->
        <div class="container-fluid">

          <div class="col-lg-12 mb-4 d-inline-block" style="padding: 0px; font-size: 30px;">
            <div class="card bg-primary text-white shadow">
              <div class="card-body">
                Marvelsystem 의 종합 보안수준 : <span id="total_score"></span>점
               <div class="text-white-50 small"></div>
              </div>
            </div>
          </div>

          <!-- Content Row -->
          <div class="row">

            <!-- Earnings (Monthly) Card Example -->
            <div class="col-xl-4 col-md-6 mb-4 centered">
              <div class="card border-left-primary shadow h-100 py-2">
                <div class="card-body">
                  <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                      <div class="h5 mb-0 font-weight-bold text-gray-800"><span id="na_section"></span> 건</div>
                      <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">최근 1년 N/A 누적 건수</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Earnings (Monthly) Card Example -->
            <div class="col-xl-4 col-md-6 mb-4 centered">
              <div class="card border-left-success shadow h-100 py-2">
                <div class="card-body">
                  <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                      <div class="h5 mb-0 font-weight-bold text-gray-800"><span id="ra_section"></span> 건</div>
                      <div class="text-xs font-weight-bold text-success text-uppercase mb-1">최근 1년 R/A 누적 건수</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Pending Requests Card Example -->
            <div class="col-xl-4 col-md-6 mb-4 centered">
              <div class="card border-left-warning shadow h-100 py-2">
                <div class="card-body to_list">
                  <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
<!--                      <div class="text-xs font-weight-bold text-warning text-uppercase mb-1"></div>-->
                      <div class="h5 mb-0 font-weight-bold text-gray-800">
                        <span style="line-height: 2.2;">최근 점검 계획 및 현황</span> <i class="fas fa-arrow-right"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Content Row -->

          <div class="row">
            <!-- Area Chart -->
            <div class="col-xl-12 col-lg-7">
              <div class="card shadow mb-4">
                <!-- Card Header - Dropdown -->
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                  <h6 class="m-0 font-weight-bold text-primary">최근 1년 보안 그래프</h6>
                  <div class="dropdown no-arrow">
                    <a href="#" class="btn btn-info btn-icon-split">
                      <span class="text">인프라 점검</span>
                    </a>
                    <a href="#" class="btn btn-info btn-icon-split">
                      <span class="text">ICT 월간점검</span>
                    </a>
                    <a href="#" class="btn btn-info btn-icon-split">
                      <span class="text">개인정보보호 점검</span>
                    </a>
                  </div>
                </div>
                <!-- Card Body -->
                <div class="card-body">
                  <div class="chart-area">
                    <canvas id="myAreaChart"></canvas>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="row">
            <!-- Area Chart -->
            <div class="col-xl-12 col-lg-7">
              <div class="card shadow mb-4">
                <!-- Card Header - Dropdown -->
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                  <h6 class="m-0 font-weight-bold text-primary">점검 분야별 준수율</h6>
                </div>
                <!-- Card Body -->
                <div class="card-body centered">
                  <div class="col-lg-2 mb-4 d-inline-block">
                    <div class="card shadow">
                      <div class="card-body">
                        <span id="OS_perc"></span>
                        <div class="small">OS</div>
                      </div>
                    </div>
                  </div>
                  <div class="col-lg-2 mb-4 d-inline-block">
                    <div class="card shadow">
                      <div class="card-body">
                        <span id="DBMS_perc"></span>
                        <div class="small">DBMS</div>
                      </div>
                    </div>
                  </div>
                  <div class="col-lg-2 mb-4 d-inline-block">
                    <div class="card shadow">
                      <div class="card-body">
                        <span id="WEB_perc"></span>
                        <div class="small">WEB</div>
                      </div>
                    </div>
                  </div>
                  <div class="col-lg-2 mb-4 d-inline-block">
                    <div class="card shadow">
                      <div class="card-body">
                        <span id="Network_perc"></span>
                        <div class="small">Network</div>
                      </div>
                    </div>
                  </div>
                  <div class="col-lg-2 mb-4 d-inline-block">
                    <div class="card shadow">
                      <div class="card-body">
                        <span id="SH_perc"></span>
                        <div class="small">보안장비</div>
                      </div>
                    </div>
                  </div>
                  <div class="col-lg-2 mb-4 d-inline-block">
                    <div class="card shadow">
                      <div class="card-body">
                        <span id="SM_perc"></span>
                        <div class="small">관리보안</div>
                      </div>
                    </div>
                  </div>
                  <div class="col-lg-2 mb-4 d-inline-block">
                    <div class="card shadow">
                      <div class="card-body">
                        <span id="privacy_perc"></span>
                        <div class="small">개인정보</div>
                      </div>
                    </div>
                  </div>
                  <div class="col-lg-2 mb-4 d-inline-block">
                    <div class="card shadow">
                      <div class="card-body">
                        <span id="backup_perc"></span>
                        <div class="small">백업장비</div>
                      </div>
                    </div>
                  </div>
                  <div class="col-lg-2 mb-4 d-inline-block">
                    <div class="card shadow">
                      <div class="card-body">
                        <span id="WAS_perc"></span>
                        <div class="small">WAS</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="row">
            <!-- Pie Chart -->
            <div class="col-xl-6 col-lg-5">
              <div class="card shadow mb-4">
                <!-- Card Header - Dropdown -->
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                  <h6 class="m-0 font-weight-bold text-primary">점검 분야별 보안 수준</h6>
                  <div class="dropdown no-arrow">
                    <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                      <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                    </a>
                    <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in" aria-labelledby="dropdownMenuLink">
                      <div class="dropdown-header">Dropdown Header:</div>
                      <a class="dropdown-item" href="#">Action</a>
                      <a class="dropdown-item" href="#">Another action</a>
                      <div class="dropdown-divider"></div>
                      <a class="dropdown-item" href="#">Something else here</a>
                    </div>
                  </div>
                </div>
                <!-- Card Body -->
                <div class="card-body">
                  <div class="chart-pie pt-4 pb-2">
                    <canvas id="myRadarChart"></canvas>
                  </div>
                  <div class="mt-4 text-center small">
<!--                    <span class="mr-2">-->
<!--                      <i class="fas fa-circle text-primary"></i> Direct-->
<!--                    </span>-->
<!--                    <span class="mr-2">-->
<!--                      <i class="fas fa-circle text-success"></i> Social-->
<!--                    </span>-->
<!--                    <span class="mr-2">-->
<!--                      <i class="fas fa-circle text-info"></i> Referral-->
<!--                    </span>-->
                  </div>
                </div>
              </div>

            </div>

            <div class="col-xl-6 col-lg-5">
              <div class="card shadow mb-4">
                <!-- Card Header - Dropdown -->
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                  <h6 class="m-0 font-weight-bold text-primary">미준수 항목</h6>
                </div>
                <!-- Card Body -->
                <div class="card-body">
                  <div class="chart-pie pt-4 pb-2">
                    <div class="chartjs-size-monitor">
                      <div class="chartjs-size-monitor-expand">
                        <div class=""></div>
                      </div>
                      <div class="chartjs-size-monitor-shrink">
                        <div class=""></div>
                      </div>
                    </div>
                    <canvas id="myPieChart" width="272" height="245" class="chartjs-render-monitor" style="display: block; width: 272px; height: 245px;"></canvas>
                  </div>
                  <div class="mt-4 text-center small">
                    <span class="mr-2"><i class="fas fa-circle text-primary"></i> OS</span>
                    <span class="mr-2"><i class="fas fa-circle text-success"></i> DBMS</span>
                    <span class="mr-2"><i class="fas fa-circle text-info"></i> WEB</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

        </div>
        <!-- /.container-fluid -->

      </div>
      <!-- End of Main Content -->

      <!-- Footer -->
      <footer class="sticky-footer bg-white">
        <div class="container my-auto">
          <div class="copyright text-center my-auto">
            <span>Copyright &copy; Your Website 2020</span>
          </div>
        </div>
      </footer>
      <!-- End of Footer -->

    </div>
    <!-- End of Content Wrapper -->

  <th:block th:include="fragment/footer"></th:block>

<script>

  function radarChart(data) {

    // Set new default font family and font color to mimic Bootstrap's default styling
    Chart.defaults.global.defaultFontFamily = 'Nunito', '-apple-system,system-ui,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif';
    Chart.defaults.global.defaultFontColor = '#858796';

    // radar Chart Example
    var ctx = document.getElementById("myRadarChart");
    var options = {
        scale: {
            angleLines: {
              display: false
            },
            ticks: {
                suggestedMin: 0,
                suggestedMax: 100
            }
        }
    };
    var myRadarChart = new Chart(ctx, {
      type: 'radar',
      data: {
        labels: ['OS', 'DBMS', 'WEB', 'Network', '보안장비', '관리보안', '개인정보', '백업장비', 'WAS'],
        datasets: [{
            data: data
        }]
    }, option : options
    });

  }

  function pieChart(data) {
    // Set new default font family and font color to mimic Bootstrap's default styling
    Chart.defaults.global.defaultFontFamily = 'Nunito', '-apple-system,system-ui,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif';
    Chart.defaults.global.defaultFontColor = '#858796';

    // Pie Chart Example
    var ctx = document.getElementById("myPieChart");
    var myPieChart = new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: obj_types,
        datasets: [{
          // data: [14,10,4,2,5,1],
          data: data,
          backgroundColor: ['#4e73df', '#1cc88a', '#36b9cc','#4e73df', '#1cc88a', '#36b9cc','#36b9cc','#4e73df', '#1cc88a'],
          hoverBackgroundColor: ['#2e59d9', '#17a673', '#2c9faf','#4e73df', '#1cc88a', '#36b9cc','#4e73df', '#1cc88a', '#36b9cc'],
          hoverBorderColor: "rgba(234, 236, 244, 1)",
        }],
      },
      options: {
        maintainAspectRatio: false,
        tooltips: {
          backgroundColor: "rgb(255,255,255)",
          bodyFontColor: "#858796",
          borderColor: '#dddfeb',
          borderWidth: 1,
          xPadding: 15,
          yPadding: 15,
          displayColors: false,
          caretPadding: 10,
        },
        legend: {
          display: false
        },
        cutoutPercentage: 80,
      },
    });
  }

  $(document).ready(function() {
    var radar_data = [100, 80, 40, 70, 80, 100, 65, 20, 57];
    radarChart(radar_data);

    var memberCountConTxt= 93;
    $({ val : 0 }).animate({ val : memberCountConTxt }, {
      duration: 4000,
      step: function() {
        var num = numberWithCommas(Math.floor(this.val));
        $("#total_score").text(num);
        },
      complete: function() {
        var num = numberWithCommas(Math.floor(this.val));
        $("#total_score").text(num);
      }
    });

     $.ajax({
        type : "POST",
        url : "getRAs.do",
        success: function(data){
          var memberCountConTxt= 257;
          $({ val : 0 }).animate({ val : memberCountConTxt }, {
            duration: 3500,
            step: function() {
              var num = numberWithCommas(Math.floor(this.val));
              $("#ra_section").text(num);
              },
            complete: function() {
              var num = numberWithCommas(Math.floor(this.val));
              $("#ra_section").text(num);
            }
          });
        }
      });

      $.ajax({
        type : "POST",
        url : "getNAs.do",
        success: function(data){
          var memberCountConTxt= 103;
          $({ val : 0 }).animate({ val : memberCountConTxt }, {
            duration: 3500,
            step: function() {
              var num = numberWithCommas(Math.floor(this.val));
              $("#na_section").text(num);
              },
            complete: function() {
              var num = numberWithCommas(Math.floor(this.val));
              $("#na_section").text(num);
            }
          });
          }
      });

    $('.to_list').click(function(e){
      e.preventDefault();
      location.href = "/i_dashboard";
    });

    var noneResult = [];
    obj_types.forEach(function(e,i) {

      $.ajax({
          type : "POST",
          url : "getTotalResultListBycat.do",
          data : {
              type : e
          },
          success: function(data){

            var Done = data['DoneResult'].length;
            var Total = data['TotalResult'];
            if(Done < 1) {
              var Perc = 0;
              $('span#'+e+'_perc').parent().parent().addClass('bg-danger').addClass('text-white');
              $('span#'+e+'_perc').siblings().addClass('text-white-50');
            } else {
              var Perc = Math.ceil((Done / Total) * 100);
              if(Perc > 90 && Perc <= 100) {
                $('span#'+e+'_perc').parent().parent().addClass('bg-success').addClass('text-white');
              } else if(Perc > 75 && Perc <= 90) {
                $('span#'+e+'_perc').parent().parent().addClass('bg-primary').addClass('text-white');
              } else if(Perc > 50 && Perc <= 75) {
                $('span#'+e+'_perc').parent().parent().addClass('bg-warning').addClass('text-white');
              } else if(Perc > 0 && Perc <= 50) {
                $('span#'+e+'_perc').parent().parent().addClass('bg-danger').addClass('text-white');
              }
              $('span#'+e+'_perc').siblings().addClass('text-white-50');
            }
            $('span#'+e+'_perc').html(Perc+"%");
          }
      });

    });

    $.ajax({
          type : "POST",
          url : "getTotalNoneResultListBycat.do",
          success: function(data){
            var sum = data.reduce((a, b) => a + b);
            console.log(sum);
            if(sum == 0) {
              $('.chart-pie.pt-4.pb-2').append("<h1>미준수 항목이 없습니다!</h1>");
            }
            pieChart(data);
          }
      });

  });
</script>