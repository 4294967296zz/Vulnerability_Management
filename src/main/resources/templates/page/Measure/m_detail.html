<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
  <th:block th:include="fragment/header"></th:block>

    <!-- Content Wrapper -->
    <div id="content-wrapper" class="d-flex flex-column">

      <!-- Main Content -->
      <div id="content">
        <th:block th:include="fragment/nav"></th:block>

        <!-- Begin Page Content -->
        <div class="container-fluid">

          <!-- Page Heading -->
          <div class="col-xl-12 col-lg-7 no-padding">
               <div class="card shadow mb-4">
                  <div class="card-body">
                      <h1 class="h3 mb-2 text-gray-800">조치계획 등록</h1>
                      <p>항목명을 클릭하여 상세 내용을 확인합니다. <br>조치여부의 아이콘을 클릭하여 조치 등록과 조치계획을 확인할 수 있습니다.</p>
                  </div>
              </div>
          </div>

          <div class="row">
              <div class="col-xl-12 col-lg-7">
                <!-- DataTales Example -->
                <div class="card shadow mb-4">
              <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                <h6 class="m-0 font-weight-bold text-primary" id="iname_section">2020년 정보보안 테스트</h6>
              </div>
              <div class="card-body">
                <div class="table-responsive">
                  <table class="table table-bordered" id="MeasureDetail_dataTable" width="100%" cellspacing="0">
                    <thead>
                    <tr>
                      <th class="detail"><i class="fas fa-plus"></i></th>
                      <th class="confCategory">분류</th>
                      <th class="name">항목명</th>
                      <th class="danger">위험도</th>
                      <th class="require">요구수준</th>
                    </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
            </div>
              </div>
          </div> <!-- end of row-->

        </div>
        <!-- /.container-fluid -->

          <!-- 레이어 팝업 -->
        <div class="layer">
            <div class="bg"></div>
            <div id="layer1" class="pop-layer" style="display: none; width: 600px;">
                <div class="pop-container">
                    <div class="pop-conts">
                        <div class="btn-r">
                            <a href="#" class="cbtn"><i class="fas fa-times"></i></a>
                        </div>
                        <div class="card mb-4">
                            <div class="card-header">
                                <h6 class="m-0 font-weight-bold text-primary">자체점검 : THE-001. 정기적으로 사무실 보안에 대한 점검이 이루어지고 있는가?</h6>
                            </div>
                          <div class="card-body">
                            점검대상정보 : 월1회[부서별자체점검/정보보호팀] - 노바_123_월1회
                          </div>
                        </div>

                        <div class="reg-contents">
                          <div class="inputs">
                            처리 유형 <span class="required"> *</span>
                            <input type="checkbox"> 조치처리 등록
                            <input type="checkbox"> 협의 필요
                          </div>
                          <div class="inputs">
                            조치기간 <span class="required"> *</span>
                            <input type="date" placeholder="조치예정 기간을 설정하세요">
                          </div>
                          <div class="inputs">
                            의견 <span class="required"> *</span>
                            <textarea></textarea>
                          </div>
                          <div class="inputs">
                            증빙자료
                            <input type="file">
                          </div>
                          <a href="#" class="btn btn-primary btn-icon-split">
                            <span class="icon text-white-50">
                              <i class="fas fa-check"></i>
                            </span>
                            <span class="text">등록하기</span>
                          </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- 레이어 팝업 end -->

      </div>
      <!-- End of Main Content -->

      <!-- Footer -->
      <footer class="sticky-footer bg-white">
        <div class="container my-auto">
          <div class="copyright text-center my-auto">
            <span>Copyright &copy; Your Website 2020</span>
          </div>
        </div>
      </footer>
      <!-- End of Footer -->

    </div>
    <!-- End of Content Wrapper -->

  </div>
  <!-- End of Page Wrapper -->

  <th:block th:include="fragment/footer"></th:block>

  <script>

      var iid = geturlparam('iid');
      var cgid;
      var cids;

      function format ( d ) {
          return '<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;">'+
              '<tr>'+
                '<td class="c_detail_th">점검항목 내용</td>'+
                '<td class="c_detail_tb">'+d.content+'</td>'+
              '</tr>'+
              '<tr>'+
                '<td class="c_detail_th">준수기준</td>'+
                '<td class="c_detail_tb">'+d.comply+'</td>'+
              '</tr>'+
              '<tr>'+
                '<td class="c_detail_th">지침 및 메뉴얼</td>'+
                '<td class="c_detail_tb">'+d.manual+'</td>'+
              '</tr>'+
            '</table>';
      }

      $.ajax({
        type : "POST",
        url : "getInspect.do",
        async : false,
        data : {
          'iid' : iid
        },
        success: function(data){
          console.log(data);
          cgid = data.data.cgid;
        }
      });



      $(document).ready(function() {

          $.ajax({
              type : "POST",
              url : "getConfluenceGroup.do",
              async : false,
              data : {
                'cgid' : cgid
              },
              success: function(data){
                cids = data.data.confs;
                console.log(cids);
              }
          });


          var table = $('#MeasureDetail_dataTable').DataTable( {
            ajax : {
              type : "POST",
              url : "getConfs.do",
              data : {
                'cid' : cids
              }
            },
            destroy : true,
            language : lang_kor,
            buttons : buttons,
            ordering : false,
            scrollX : "100%",
            sScrollXInner: "1150px",
            dom: "<'row'<'col-xl-12 col-lg-7 no-padding'lfrtip>>"+"",
            columnDefs: [{
              className: "name",
              "targets": [ 2 ]
            }],
            columns : [
              {
                className:'details-control dt-2',
                orderable:false,
                data:null,
                defaultContent: '',
                render: function() {
                  return '<img src="/img/plus_icon.png" style="width:100%;">';
                }
              },
              {
                data : "type",
                className : 'dt-25'
              },
              {
                data : "cname",
                className : 'dt-16'
              },
              {
                data : "risk",
                className : ''
              },
              {
                data : "demand",
                className : ''
              },
            ], success : { function(data) {
              console.log(data);
              }}
          });

          $('#MeasureDetail_dataTable tbody').on('click', 'td.details-control', function () {
              var tr = $(this).closest('tr');
              var row = table.row( tr );
              if ( row.child.isShown() ) {
                // This row is already open - close it
                row.child.hide();
                tr.removeClass('shown');
              } else {
                // Open this row
                row.child( format(row.data()) ).show();
                tr.addClass('shown');
              }
          });

          $('.table-filter').on('change', function(){
             table.search(this.value).draw();
          });

          $('.reg-btn').click(function(e) {
              e.preventDefault();
              layer_open('layer1');
          });

      });
  </script>

