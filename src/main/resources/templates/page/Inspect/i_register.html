<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
  <th:block th:include="fragment/header"></th:block>

    <!-- Content Wrapper -->
    <div id="content-wrapper" class="d-flex flex-column">

      <!-- Main Content -->
      <div id="content">
        <th:block th:include="fragment/nav"></th:block>

        <!-- Begin Page Content -->
        <div class="container-fluid">

          <!-- Page Heading -->
          <div class="col-xl-12 col-lg-7 no-padding">
               <div class="card shadow mb-4">
                  <div class="card-body">
                      <h1 class="h3 mb-2 text-gray-800">점검계획 등록</h1>
                      <p>[Step 1]점검계획 기본정보 설정 : 모든 항목은 필수 입력 값이며, 점검계획 기간의 시작일이 포함된 월로 [점검계획 현황] 메뉴에서 확인할 수 있습니다. <br>
                        [Step 2] 점검대상 등록 : 탭으로 구분된 점검대상 분류를 선택하고 점검에 등록할 점검대상을 선택합니다. <br>
                        [Step 3] 확인 : 입력한 정보를 확인하고 점검 등록을 완료합니다.</p>
                  </div>
              </div>
          </div>

          <div class="row">

            <div class="col-lg-4">
              <div class="card mb-4 py-3 border-left-primary centered pointered" id="step_01">
                <div class="card-body no-padding">
                  01 기본정보 설정
                </div>
              </div>
            </div>

            <div class="col-lg-4">
              <div class="card mb-4 py-3 border-left-secondary centered pointered" id="step_02">
                <div class="card-body no-padding">
                  02 점검대상 등록
                </div>
              </div>
            </div>

            <div class="col-lg-4">
              <div class="card mb-4 py-3 border-left-secondary centered pointered" id="step_03">
                <div class="card-body no-padding">
                  03 최종 확인
                </div>
              </div>
            </div>

          </div>
          <!-- /.row -->

          <div class="row">
            <div class="col-lg-12">
              <div class="card mb-4">
                <div class="card-body">
<!--                  <form action="/register_inspect" method="post">-->
                    <div class="reg-contents step_01">

                      <div class="inputs">
                        점검명<span class="required"> *</span>
                          <input type="text" class="text-inputs" name="iName">
                      </div>

                      <div class="inputs">
                        점검항목그룹<span class="required"> *</span>
                        <select class="text-inputs" name="igid">
                          <option>선택</option>
                          <option value="1">그룹1</option>
                          <option value="3">그룹3</option>
                          <option value="4">그룹4</option>
                        </select>
                      </div>

                      <div class="inputs">
                        점검유형<span class="required"> *</span>
                        <input type="radio" name="type" value="인프라점검"> 인프라점검
                        <input type="radio" name="type" value="ICT 월간점검"> ICT 월간점검
                        <input type="radio" name="type" value="개인정보점검"> 개인정보점검
                        <input type="radio" name="type" value="자체(테마)점검"> 자체(테마)점검
                        <input type="radio" name="type" value="신규점검"> 신규점검
                      </div>

                      <div class="inputs">
                        점검기간<span class="required"> *</span>
                        <input type="date" class="text-inputs" name="idate"> ~
                        <input type="date" class="text-inputs" name="idate">
                      </div>

                      <div class="inputs">
                        조치계획 등록기간<span class="required"> *</span>
                        <input type="date" class="text-inputs" name="mdate"> ~
                        <input type="date" class="text-inputs" name="mdate">
                      </div>

                      <div class="inputs">
                        상세정보<span class="required"> *</span>
                        <textarea class="text-inputs" name="content"></textarea>
                      </div>

                      <a href="#" class="btn btn-primary btn-icon-split step-btn next">
                        <span class="text">다음</span>
                      </a>

                    </div>
                    <!-- /.step-01 -->

                    <div class="reg-contents step_02" style="display: none; margin: 0;">
                      <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between no-border no-background">
                        <h6 class="m-0 font-weight-bold text-primary">점검대상 목록</h6>
                        <div class="dropdown no-arrow">
                          <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                          </a>
                          <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in" aria-labelledby="dropdownMenuLink">
                            <div class="dropdown-header">점검대상 관리:</div>
                            <a class="dropdown-item" href="#" id="object_reg"><i class="fas fa-plus"></i> 점검대상 등록</a>
                            <a class="dropdown-item" href="#" id="object_del"><i class="fas fa-minus-square"></i> 점검대상 삭제</a>
                          </div>
                        </div>
                      </div>
                      <div class="card-body">
                        <div class="table-responsive">
                          <table class="table table-bordered" id="InspectRegister_dataTable" width="100%" cellspacing="0">
                            <thead>
                            <tr>
                              <th><input type="checkbox" id="check_all"></th>
                              <th>유형</th>
                              <th>이름</th>
                              <th>용도</th>
                              <th>담당조직</th>
                              <th>운영부서1</th>
                              <th>운영부서2</th>
                              <th>IP주소</th>
                              <th>위치정보</th>
                            </tr>
                            </thead>
                            <tbody></tbody>
                          </table>
                        </div>
                      </div>
                      <a href="#" class="btn btn-light btn-icon-split step-btn prev">
                        <span class="text">이전</span>
                      </a>
                      <a href="#" class="btn btn-primary btn-icon-split step-btn next">
                        <span class="text">다음</span>

                      </a>
                    </div>
                    <!-- /.step-02 -->

                    <div class="reg-contents step_03" style="display: none;">
                        <div class="inputs">
                          점검명 : <span class="iname"></span>
                        </div>

                        <div class="inputs">
                          점검항목그룹 : <span class="igid"></span>
                        </div>

                        <div class="inputs">
                          점검기간 : <span class="idate"></span>
                        </div>

                        <div class="inputs">
                          조치계획 등록기간 : <span class="mdate"></span>

                        <div class="inputs">
                          상세정보 : <span class="content"></span>
                        </div>
                        <a href="#" class="btn btn-light btn-icon-split step-btn prev">
                          <span class="text">이전</span>
                        </a>
                        <a href="#" class="btn btn-primary btn-icon-split done-btn">
                          <span class="text">완료</span>
                        </a>
                    </div>
                  <!-- /.step-03 -->
<!--                  </form>-->

                </div>
              </div>
            </div>

          </div>

        </div>
        <!-- /.container-fluid -->

        <!-- 레이어 팝업 -->
      <div class="layer" id="manage_obj_popup">
          <div class="bg"></div>
          <div id="layer1" class="pop-layer" style="display: none; width: 1000px; max-width: 1000px;">
              <div class="pop-container">
                  <div class="pop-conts">
                      <div class="btn-r">
                          <a href="#" class="cbtn"><i class="fas fa-times"></i></a>
                      </div>
                      <div class="row">
                        <div class="col-xl-12 col-lg-7">
                          <h6>점검대상 전체 목록</h6>
                          <div class="popup-table" style="text-align: center;">
                          <div class="table-responsive">
                            <ul class="nav nav-tabs manage_list list-tabs" role="tablist">
                              <li class="active">
                                <a href="#" data-toggle="tab" id="all">전체</a>
                              </li>
                              <li class="">
                                <a href="#" data-toggle="tab" id="OS">OS</a>
                              </li>
                              <li class="">
                                <a href="#" data-toggle="tab" id="DBMS">DBMS</a>
                              </li>
                              <li class="">
                                <a href="#" data-toggle="tab" id="WEB">WEB/WAS</a>
                              </li>
                              <li class="">
                                <a href="#" data-toggle="tab" id="Network">Network</a>
                              </li>
                              <li class="">
                                <a href="#" data-toggle="tab" id="gear">보안장비</a>
                              </li>
                              <li class="">
                                <a href="#" data-toggle="tab" id="manages">관리보안</a>
                              </li>
                              <li class="">
                                <a href="#" data-toggle="tab" id="private">개인정보보호</a>
                              </li>
                            </ul>
                            <table class="table table-bordered" id="ManageObjects_dataTable" width="100%" cellspacing="0">
                              <thead>
                              <tr>
                                <th><input type="checkbox" id="check_all2"></th>
                                <th>유형</th>
                                <th>이름</th>
                                <th>용도</th>
                                <th>담당조직</th>
                                <th>운영부서1</th>
                                <th>운영부서2</th>
                                <th>IP주소</th>
                                <th>위치정보</th>
                              </tr>
                              </thead>
                              <tbody></tbody>
                            </table>
                            <a href="#" class="btn btn-primary btn-icon-split" id="add_objs" style="margin-bottom: 20px;">
                              <span class="text" id="update_IO_table">점검대상 추가</span>
                            </a>
                          </div>
                        </div>
                        </div>
                      </div>
                  </div>
              </div>
          </div>
      </div>
      <!-- 레이어 팝업 end -->

      </div>
      <!-- End of Main Content -->

      <!-- Footer -->
      <footer class="sticky-footer bg-white">
        <div class="container my-auto">
          <div class="copyright text-center my-auto">
            <span>Copyright &copy; Your Website 2020</span>
          </div>
        </div>
      </footer>
      <!-- End of Footer -->

    </div>
    <!-- End of Content Wrapper -->

  </div>
  <!-- End of Page Wrapper -->

  <th:block th:include="fragment/footer"></th:block>

<script>

  var InspectRegister_dataSet = [
      [
          '<input type="checkbox" class="checked" name="MeasureChecked" value="obj_1">',
          '마블시스템/ICT본부',
          'hostnm_133321',
          '123.131.234.424',
          'DBMS',
          'hp-ux-001',
          '1.113',
          '마블_13321-hp-ux',
          '마블시스템/인프라운영팀'
      ],
      [
          '<input type="checkbox" class="checked" name="MeasureChecked" value="obj_2">',
          '마블시스템/ICT본부',
          'hostnm_133321',
          '123.131.234.424',
          'DBMS',
          'hp-ux-001',
          '1.113',
          '마블_13321-hp-ux',
          '마블시스템/인프라운영팀'
      ],
      [
          '<input type="checkbox" class="checked" name="MeasureChecked" value="obj_3">',
          '마블시스템/ICT본부',
          'hostnm_133321',
          '123.131.234.424',
          'DBMS',
          'hp-ux-001',
          '1.113',
          '마블_13321-hp-ux',
          '마블시스템/인프라운영팀'
      ],
      [
          '<input type="checkbox" class="checked" name="MeasureChecked" value="obj_4">',
          '마블시스템/ICT본부',
          'hostnm_133321',
          '123.131.234.424',
          'HP-UX',
          'hp-ux-001',
          '1.113',
          '마블_13321-hp-ux',
          '마블시스템/인프라운영팀'
      ],
      [
          '<input type="checkbox" class="checked" name="MeasureChecked" value="obj_5">',
          '마블시스템/ICT본부',
          'hostnm_133321',
          '123.131.234.424',
          'HP-UX',
          'hp-ux-001',
          '1.113',
          '마블_13321-hp-ux',
          '마블시스템/인프라운영팀'
      ],
      [
          '<input type="checkbox" class="checked" name="MeasureChecked" value="obj_6">',
          '마블시스템/ICT본부',
          'hostnm_133321',
          '123.131.234.424',
          'HP-UX',
          'hp-ux-001',
          '1.113',
          '마블_13321-hp-ux',
          '마블시스템/인프라운영팀'
      ],
      [
          '<input type="checkbox" class="checked" name="MeasureChecked" value="obj_7">',
          '마블시스템/ICT본부',
          'hostnm_133321',
          '123.131.234.424',
          'HP-UX',
          'hp-ux-001',
          '1.113',
          '마블_13321-hp-ux',
          '마블시스템/인프라운영팀'
      ],
      [
          '<input type="checkbox" class="checked" name="MeasureChecked" value="obj_8">',
          '마블시스템/ICT본부',
          'hostnm_133321',
          '123.131.234.424',
          'HP-UX',
          'hp-ux-001',
          '1.113',
          '마블_13321-hp-ux',
          '마블시스템/인프라운영팀'
      ],
      [
          '<input type="checkbox" class="checked" name="MeasureChecked" value="obj_9">',
          '마블시스템/ICT본부',
          'hostnm_133321',
          '123.131.234.424',
          'gear',
          'hp-ux-001',
          '1.113',
          '마블_13321-hp-ux',
          '마블시스템/인프라운영팀'
      ],
            [
          '<input type="checkbox" class="checked" name="MeasureChecked" value="obj_10">',
          '마블시스템/ICT본부',
          'hostnm_133321',
          '123.131.234.424',
          'gear',
          'hp-ux-001',
          '1.113',
          '마블_13321-hp-ux',
          '마블시스템/인프라운영팀'
      ],
            [
          '<input type="checkbox" class="checked" name="MeasureChecked" value="obj_11">',
          '마블시스템/ICT본부',
          'hostnm_133321',
          '123.131.234.424',
          'gear',
          'hp-ux-001',
          '1.113',
          '마블_13321-hp-ux',
          '마블시스템/인프라운영팀'
      ],
            [
          '<input type="checkbox" class="checked" name="MeasureChecked" value="obj_12">',
          '마블시스템/ICT본부',
          'hostnm_133321',
          '123.131.234.424',
          'HP-UX',
          'hp-ux-001',
          '1.113',
          '마블_13321-hp-ux',
          '마블시스템/인프라운영팀'
      ],
  ];

    var lang_kor = {
        "decimal" : "",
        "emptyTable" : "데이터가 없습니다.",
        "info" : "_START_ - _END_ (총 _TOTAL_ 건)",
        "infoEmpty" : "0건",
        "infoFiltered" : "(전체 _MAX_ 명 중 검색결과)",
        "infoPostFix" : "",
        "thousands" : ",",
        "lengthMenu" : "_MENU_ 개씩 보기",
        "loadingRecords" : "로딩중...",
        "processing" : "처리중...",
        "search" : "검색 : ",
        "zeroRecords" : "점검대상이 없습니다.",
        "paginate" : {
            "first" : "첫 페이지",
            "last" : "마지막 페이지",
            "next" : "다음",
            "previous" : "이전"
        },
        "aria" : {
            "sortAscending" : " :  오름차순 정렬",
            "sortDescending" : " :  내림차순 정렬"
        }
    };

  function step_contents(name, next = false, btn_type = null) {
    if(next) {

      var steps = name.slice(-1);

      if(btn_type<0) {
        var nname = Number(steps)+1;
      } else {
        if(steps == 1) {
          var nname = steps;
        } else {
          var nname = Number(steps)-1;
        }
      }
      $('.reg-contents').hide();
      $('.reg-contents.step_0'+nname).show();
      $('.card.mb-4.py-3').removeClass('border-left-primary').addClass('border-left-secondary');
      $('#step_0'+nname).removeClass('border-left-secondary').addClass('border-left-primary');
    } else {
      $('.reg-contents').hide();
      $('.reg-contents.'+name).show();
    }
  }

  function Change_tables(search){
      $('#ManageObjects_dataTable').DataTable( {
        destroy: true,
          search:search,
        ajax : {
         type : "POST",
         url : "getObjectDatatable.do",
        },
          language : lang_kor,
          ordering : false,
          scrollX : "100%",
          sScrollXInner: "1150px",
          dom: "<'row'<'col-xl-12 col-lg-7 no-padding'lfrBtip>>"+"",
          columns : [
              {
                  data : "oid",
                  defaultContent:"",
                  'targets': 0,
                  'searchable': false,
                  'className':'dt-2',
                  "render": function (data) {
                      return '<input type="checkbox" name="MeasureChecked" data-oid="'+data+'" value="'+data+'" class="checked">';
                  }
                  },
              {data : "type", 'className': ''},
              {data : "oname", 'className':'dt-10'},
              {data : "purpose", 'className':'dt-16'},
              {data : "ogroup", 'className':'dt-16'},
              {data : "part1"},
              {data : "part2"},
              {data : "ip"},
              {data : "location", 'orderable': false, 'className': 'dt-6'},
        ],
      });
  }

  function layer_open(el){
      var temp = $('#' + el);

      $('.layer').fadeIn();	//'bg' 클래스가 존재하면 레이어가 나타나고 배경은 dimmed 된다.
      temp.fadeIn();

      // 화면의 중앙에 레이어를 띄운다.
      if (temp.outerHeight() < $(document).height() ) temp.css('margin-top', '-'+temp.outerHeight()/2+'px');
      else temp.css('top', '0px');
      if (temp.outerWidth() < $(document).width() ) temp.css('margin-left', '-'+temp.outerWidth()/2+'px');
      else temp.css('left', '0px');
      temp.show();

      temp.find('a.cbtn').click(function(e){
          e.preventDefault();
          $('.layer').fadeOut(); //'bg' 클래스가 존재하면 레이어를 사라지게 한다.
          temp.fadeOut().hide();
      });

      $('.layer .bg').click(function(e){	//배경을 클릭하면 레이어를 사라지게 하는 이벤트 핸들러
          e.preventDefault();
          $('.layer').fadeOut();
          $('.pop-layer').hide();
      });
    }

    function insertInspect() {
      $.ajax({
        url : "insertInspect.do",
        type : "POST",
        dataType : "json",
        data : {
            'iName'   : $('input[name="iName"]').val(),
            'igid'    : $('select[name="igid"]').val(),
            'type'    : $('input[name="type"]').val(),
            'idate'   : $('input[name="idate"]').val(),
            'mdate'   : $('input[name="mdate"]').val(),
            'content' : $('textarea[name="content"]').val(),
        },
          success:function(data) {
            swal({
                'title' : '완료!',
                'text' : '점검 등록을 완료하였습니다. \n 점검계획 현황에서 등록 내역을 확인하세요.',
                'icon' : 'success'
            }, function() {
                // location.reload();
                console.log(data);
            });
        }

      });

    }

    function DeleteObject(checked) {
      swal({
        'title' : '',
        'text' : '삭제가 완료되었습니다.',
      });
    }

  $(document).ready(function() {

     $('#InspectRegister_dataTable').DataTable( {
        language : lang_kor,
          scrollX : "100%",
          sScrollXInner: "1800px",
     });

     $('#ManageObjects_dataTable').DataTable( {
       ajax : {
         type : "POST",
         url : "getObjectDatatable.do",
       },
       language : lang_kor,
       ordering : false,
       scrollX : "100%",
       sScrollXInner: "1150px",
       dom: "<'row'<'col-xl-12 col-lg-7 no-padding'lfrBtip>>"+"",
       columns : [
         {
           data : "oid",
           defaultContent:"",
           'targets': 0,
           'searchable': false,
           'className':'dt-2',
           "render": function (data) {
             return '<input type="checkbox" name="MeasureChecked" data-oid="'+data+'" value="'+data+'" class="checked">';
           }
         },
         {data : "type", 'className': ''},
         {data : "oname", 'className':'dt-10'},
         {data : "purpose", 'className':'dt-16'},
         {data : "ogroup", 'className':'dt-16'},
         {data : "part1"},
         {data : "part2"},
         {data : "ip"},
         {data : "location", 'orderable': false, 'className': 'dt-6'},
        ],
      });

     $('#update_IO_table').click(function(e){
        e.preventDefault();

        var oid = [];

        $('input[name="MeasureChecked"]:checked').each(function() {
          oid.push($(this).val());
        });
        console.log(oid);

        $('#InspectRegister_dataTable').DataTable( {
          destroy: true,
          ajax : {
            type : "POST",
            url : "getObjects.do",
            dataType : "JSON",
            data : {
                'oid' : oid,
            },
            success : function(data) {
              console.log(data);
            }
          },
          language : lang_kor,
          ordering : false,
          scrollX : "100%",
          sScrollXInner: "1150px",
          dom: "<'row'<'col-xl-12 col-lg-7 no-padding'lfrBtip>>"+"",
          columns : [
              {
                data : "oid",
                defaultContent:"",
                'targets': 0,
                'searchable': false,
                'className': 'dt-2',
                "render": function (data) {
                    return '<input type="checkbox" name="MeasureChecked" data-oid="'+data+'" value="'+data+'" class="checked">';
                }
              },
            {data : "type", 'className': ''},
            {data : "oname", 'className': 'dt-10'},
            {data : "purpose", 'className': 'dt-16'},
            {data : "ogroup", 'className': 'dt-16'},
            {data : "part1"},
            {data : "part2"},
            {data : "ip"},
            {data : "location", 'orderable': false, 'className': 'dt-6'},
          ],
       });

     });


     $('ul.manage_list li').click(function(){
        $(this).addClass('active');
        $(this).siblings().removeClass('active');
        var search = $(this).children().attr('id');
        Change_tables(search);
      });

    // 스텝 다음 버튼 클릭 시 전환 이벤트
    $('.step-btn').click(function(e) {
      e.preventDefault();
      var s_name = $(this).parent().attr('class'),
          btn_type = $(this).attr('class').indexOf("prev"),
          step_id = s_name.slice(-7);
      step_contents(step_id, s_name, btn_type);
    });

    // 스텝 헤더 선택 시 active 및 박스내용 변경
    $('.card.mb-4.py-3').click(function(e) {
      e.preventDefault();
      var step_id = $(this).attr('id');
      $('.card.mb-4.py-3').removeClass('border-left-primary').addClass('border-left-secondary');
      $(this).removeClass('border-left-secondary').addClass('border-left-primary');
      step_contents(step_id, false);
    });

    $('#object_reg').click(function(e) {
        e.preventDefault();
        layer_open("layer1");
      });

      $('#object_del').click(function(e) {
        e.preventDefault();

        var checkBoxArr = [];

        $('input[name="MeasureChecked"]:checked').each(function() {
          checkBoxArr.push($(this).val());
        });

        if(checkBoxArr.length < 1) {
          swal({
            'title' : '',
            'text' : '삭제할 대상을 선택해주세요.',
            'type' : 'warning',
          });
        } else {
          swal({
              title : '점검대상 삭제',
              text : '선택한 점검대상을 삭제하시겠습니까?',
              type : "warning",
              showCancelButton : true,
              confirmButtonClass : "btn-danger",
              confirmButtonText : "삭제",
              cancelButtonText : "아니오",
          }, function(isConfirm) {
              if(isConfirm) {
                DeleteObject(checkBoxArr);
              }
          });
        }

      });

      $('#add_objs').click(function(e) {
          e.preventDefault();
        $('.layer').fadeOut().hide();
      });

      $('#step_03').click(function(e) {

        var iname   = $('input[name="iName"]').val(),
            igid    = $('select[name="igid"]').val(),
            idate   = $('input[name="idate"]').val(),
            mdate   = $('input[name="mdate"]').val(),
            content = $('textarea[name="content"]').val();

        $('span.iname').html(iname);
        $('span.igid').html(igid);
        $('span.idate').html(idate);
        $('span.mdate').html(mdate);
        $('span.content').html(content);
        console.log(iname);

      });

    $('.done-btn').click(function(e) {
      e.preventDefault();

      insertInspect();

    });

  });

</script>