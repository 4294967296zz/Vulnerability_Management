<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
  <th:block th:include="fragment/header"></th:block>

    <!-- Content Wrapper -->
    <div id="content-wrapper" class="d-flex flex-column">

      <!-- Main Content -->
      <div id="content">
        <th:block th:include="fragment/nav"></th:block>

        <!-- Begin Page Content -->
        <div class="container-fluid">

            <div class="d-sm-flex align-items-center justify-content-between mb-4">
                <h1 class="h3 mb-0 text-gray-800">점검완료리스트 상세</h1>
            </div>

            <div class="row">
                <div class="col-xl-12 col-lg-7">
                  <div class="card shadow mb-4">
                    <!-- Card Header - Dropdown -->
                    <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                      <h5 class="m-0 font-weight-bold text-primary" id="iname_section"></h5>
                    </div>
                    <!-- Card Body -->
                    <div class="card-body">
                        <div class="col-lg-5 mb-4 d-inline-block">
                            <div class="card bg-info text-white shadow">
                                <div class="card-body">
                                    <span id="inspect_date"></span>
                                    <div class="text-white-50 ">점검일시</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-5 mb-4 d-inline-block">
                            <div class="card bg-success text-white shadow">
                                <div class="card-body">
                                    <span id="measure_date"></span>
                                    <div class="text-white-50 ">조치일시</div>
                                </div>
                            </div>
                        </div>
                    </div>
                  </div>
                </div>
            </div> <!-- end of row-->

            <div class="row">
                <div class="col-lg-4">
                    <div class="card shadow mb-4">
                        <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                            <h6 class="m-0 font-weight-bold text-primary">01 점검대상정보</h6>
                        </div>
                        <div class="card-body">
                            <div class="content_wrapper">
                                <div class="object-info">
                                    <span class="m-0 font-weight-bold text-primary">대상이름</span><div class="oname divider"></div>
                                    <span class="m-0 font-weight-bold text-primary">아이피</span><div class="ip divider"></div>
                                    <span class="m-0 font-weight-bold text-primary">위치</span><div class="location divider"></div>
                                    <span class="m-0 font-weight-bold text-primary">용도</span><div class="purpose divider"></div>
                                    <span class="m-0 font-weight-bold text-primary">담당자1</span><div class="part1 divider"></div>
                                    <span class="m-0 font-weight-bold text-primary">담당자2</span><div class="part2 divider"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-4">
                    <div class="card shadow mb-4">
                        <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                            <h6 class="m-0 font-weight-bold text-primary">02 점검항목정보</h6>
                        </div>
                        <div class="card-body">
                            <div class="content_wrapper">
                                <div class="conf-info">
                                    <span class="m-0 font-weight-bold text-primary">점검분류</span><div class="confCategory divider"></div>
                                    <span class="m-0 font-weight-bold text-primary">항목명</span><div class="cname divider"></div>
                                    <span class="m-0 font-weight-bold text-primary">점검내용</span><div class="content divider"></div>
                                    <span class="m-0 font-weight-bold text-primary">위험도</span><div class="risk divider"></div>
                                    <span class="m-0 font-weight-bold text-primary">요구수준</span><div class="demand divider"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <!-- DataTales Example -->
                    <div class="card shadow mb-4">
                        <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                            <h6 class="m-0 font-weight-bold text-primary">03 조치정보</h6>
                        </div>
                        <div class="card-body">
                            <div class="content_wrapper">
                                <div class="measure-info">
                                    <span class="m-0 font-weight-bold text-primary">조치상태</span><div class="status divider"></div>
                                    <span class="m-0 font-weight-bold text-primary">조치내용</span><div class="comment divider"></div>
                                    <span class="m-0 font-weight-bold text-primary">조치상태</span><div class="type divider"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div> <!-- end of row-->

        </div>
        <!-- /.container-fluid -->

      </div>
      <!-- End of Main Content -->

      <!-- 레이어 팝업 -->
      <div class="layer">
          <div class="bg"></div>
          <div id="layer1" class="pop-layer" style="display: none; width: 600px;">
              <div class="pop-container">
                  <div class="pop-conts">
                      <div class="btn-r">
                          <a href="#" class="cbtn"><i class="fas fa-times"></i></a>
                      </div>
                      <div class="card mb-4">
                          <div class="card-header">
                              <h6 class="m-0 font-weight-bold text-primary">ISS-001보안장비 정책 및 로그 백업 설정</h6>
                          </div>
                          <div class="card-body">
                              점검결과 : 미준수<br>
                              점검 내용 : 보안장비 장애, 가동중지 등 비상상황 발생 시 신속하게 시스템의 정상복구가 가능하도록 하기 위함<br>
                              위험도 : H<br>
                              준수기준 : 전자금융기반시설 보안 취약점 평가기준<br>
                              조치가이드 : 네네
                          </div>
                      </div>
                  </div>
              </div>
          </div>
          <div id="layer2" class="pop-layer" style="display: none; width: 800px;">
              <div class="pop-container">
                  <div class="pop-conts">
                      <div class="btn-r">
                          <a href="#" class="cbtn"><i class="fas fa-times"></i></a>
                      </div>
                      <div class="timeline">

                          <div class="row">
                              <div class="col-lg-2 mb-4 centered">
                                  <div class="card bg-primary text-white shadow">
                                      <div class="card-body pointered">
                                          협의필요
                                      </div>
                                  </div>
                              </div>
                              <div class="col-lg-2 mb-4 centered">
                                  <div class="card bg-light text-black shadow">
                                      <div class="card-body pointered">
                                          R/A
                                      </div>
                                  </div>
                              </div>
                              <div class="col-lg-2 mb-4 centered">
                                  <div class="card bg-light text-black shadow">
                                      <div class="card-body pointered">
                                          티켓처리
                                      </div>
                                  </div>
                              </div>
                              <div class="col-lg-2 mb-4 centered">
                                  <div class="card bg-light text-black shadow">
                                      <div class="card-body pointered">
                                          티켓종결
                                      </div>
                                  </div>
                              </div>
                          </div>

                          <div class="row">
                              <div class="card mb-4">
                                  <div class="card-body">
                                      <div class="contents">
                                          선택한 타임라인에 따른 내용 출력<br><br>
                                          [협의 완료 후 종결]<br><br>
                                          [개별수립] 권리보장제도 운영실태 점검 미준수 1건에 대해 ＇마케팅 연락중지 청구권＇ 협의가 진행중입니다.<br>
                                          2020-04-13 15:44:01 노바소프트그룹 / 정보보호팀 보안운영지원 / 전태린
                                      </div>
                                  </div>
                              </div>
                          </div>

                      </div>
                  </div>
              </div>
          </div>
      </div>
      <!-- 레이어 팝업 end -->

      <!-- Footer -->
      <footer class="sticky-footer bg-white">
        <div class="container my-auto">
          <div class="copyright text-center my-auto">
            <span>Copyright &copy; Your Website 2020</span>
          </div>
        </div>
      </footer>
      <!-- End of Footer -->

    </div>
    <!-- End of Content Wrapper -->

  </div>
  <!-- End of Page Wrapper -->

  <th:block th:include="fragment/footer"></th:block>

  <script>

      var iid = geturlparam('iid');
      var rid = geturlparam('rid');
      var cgid;
      var igid;
      var iname;
      var oids;
      var totalList = [];
      var data_arr = new Array();

      $.ajax({
        type : "POST",
        url : "getInspect.do",
        async : false,
        data : {
          'iid' : iid
        },
        success: function(data){
          cgid = data.data.cgid;
          igid = data.data.igid;
          iname = data.data.iname;
        }
      });

      $.ajax({
          type : "POST",
          url : "getInspectGroup.do",
          async : false,
          data : {
            'igid' : igid
          },
          success: function(data){
            oids = strToarr(data.data.objects);
          }
      });

      $.ajax({
          type : "POST",
          url : "getConfluenceGroup.do",
          async : false,
          data : {
            'cgid' : cgid
          },
          success: function(data){
            cids = strToarr(data.data.confs);
          }
      });

    $(document).ready(function() {

        $.ajax({
            type : "POST",
            url : "getTotalResultListByRid.do",
            async : false,
            data : {
                'rid' : rid
            },
            success : function(data) {
                console.log(data);
                for(i=0; i<data.length; i++) {
                    data_arr['rid']          = Number(data[i][0]['rid']);
                    data_arr['iid']          = Number(data[i][0]['iid']);
                    data_arr['oid']          = Number(data[i][0]['oid']);
                    data_arr['cid']          = Number(data[i][0]['cid']);
                    data_arr['idate']        = data[i][0]['date'];
                    data_arr['cname']        = data[i][1]['cname'];
                    data_arr['confCategory'] = data[i][1]['confCategory'];
                    data_arr['content']      = data[i][1]['content'];
                    data_arr['risk']         = data[i][1]['risk'];
                    data_arr['demand']       = data[i][1]['demand'];
                    data_arr['ip']           = data[i][2]['ip'];
                    data_arr['location']     = data[i][2]['location'];
                    data_arr['oname']        = data[i][2]['oname'];
                    data_arr['part1']        = data[i][2]['part1'];
                    data_arr['part2']        = data[i][2]['part2'];
                    data_arr['purpose']      = data[i][2]['purpose'];
                    data_arr['comment']      = data[i][3]['comment'];
                    data_arr['status']       = data[i][3]['status'];
                    data_arr['type']         = data[i][3]['type'];
                    data_arr['stDate']       = data[i][3]['stDate'];
                    data_arr['exDate']       = data[i][3]['exDate'];
                    totalList.push(data_arr);
                    data_arr = [];
                }
            }
        });

        $('#iname_section').html(iname+' - '+totalList[0]['oname']);
        $('#object_count').html(oids.length);
        $('#conf_count').html(cids.length);
        $('#inspect_date').html(totalList[0]['idate']);
        $('#measure_date').html(totalList[0]['stDate']+' ~ '+totalList[0]['exDate']);
        $('.object-info .oname').html(totalList[0]['oname']);
        $('.object-info .ip').html(totalList[0]['ip']);
        $('.object-info .location').html(totalList[0]['location']);
        $('.object-info .purpose').html(totalList[0]['purpose']);
        $('.object-info .part1').html(totalList[0]['part1']);
        $('.object-info .part2').html(totalList[0]['part2']);
        $('.conf-info .cname').html(totalList[0]['cname']);
        $('.conf-info .confCategory').html(totalList[0]['confCategory']);
        $('.conf-info .content').html(totalList[0]['content']);
        $('.conf-info .risk').html(totalList[0]['risk']);
        $('.conf-info .demand').html(totalList[0]['demand']);
        $('.measure-info .comment').html(totalList[0]['comment']);
        $('.measure-info .status').html(totalList[0]['status']);
        $('.measure-info .type').html(totalList[0]['type']);

        $('#desc_popup').click(function(e) {
            e.preventDefault();
            layer_open('layer1');
        });

        $('#detail_popup').click(function(e) {
            e.preventDefault();
            layer_open('layer2');
        });

        $('.card-body.pointered').click(function(e) {
            e.preventDefault();
            $('.card-body.pointered').parent().removeClass('bg-primary text-white').addClass('bg-light text-black');
            $(this).parent().removeClass('bg-light text-black').addClass('bg-primary text-white');
        });


    });
  </script>

