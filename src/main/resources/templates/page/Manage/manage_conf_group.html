<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
  <th:block th:include="fragment/header"></th:block>

    <!-- Content Wrapper -->
    <div id="content-wrapper" class="d-flex flex-column">

      <!-- Main Content -->
      <div id="content">
        <th:block th:include="fragment/nav"></th:block>

        <!-- Begin Page Content -->
        <div class="container-fluid">

          <!-- Page Heading -->
          <div class="col-xl-12 col-lg-7 no-padding">
               <div class="card shadow mb-4">
                  <div class="card-body">
                      <h1 class="h3 mb-2 text-gray-800">점검항목그룹</h1>
                      <p>점검의 항목이 되는 그룹을 생성하고 확인합니다.</p>
                  </div>
              </div>
          </div>

          <div class="row">
            <div class="col-xl-12 col-lg-7">
              <!-- DataTales Example -->
              <div class="card shadow mb-4">
              <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                  <h6 class="m-0 font-weight-bold text-primary">점검항목그룹</h6>
                  <div class="dropdown no-arrow">
                    <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                      <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                    </a>
                    <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in" aria-labelledby="dropdownMenuLink">
                      <div class="dropdown-header">점검항목그룹 관리:</div>
                      <a class="dropdown-item" href="#" id="ig_reg"><i class="fas fa-plus"></i> 점검항목그룹 생성</a>
                      <a class="dropdown-item" href="#" id="ig_edit"><i class="fas fa-minus-square"></i> 점검항목그룹 수정</a>
                      <a class="dropdown-item" href="#" id="ig_del"><i class="fas fa-minus-square"></i> 점검항목그룹 삭제</a>
                    </div>
                  </div>
                </div>
              <div class="card-body">
                <div class="table-responsive">
                  <table class="table table-bordered" id="ConfGroup_dataTable" width="100%" cellspacing="0">
                    <thead>
                      <tr>
                        <th><input type="checkbox" name="MeasureChecked" id="check_all"></th>
                        <th>이름</th>
                        <th>그룹명</th>
                        <th>점검항목수</th>
                      </tr>
                      </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
            </div>
            </div>
          </div> <!-- end of row-->

          <!-- 레이어 팝업 -->
      <div class="layer" id="manage_conf_popup">
          <div class="bg"></div>
          <div id="layer1" class="pop-layer" style="display: none; width: 1000px; max-width: 1000px;">
              <div class="pop-container">
                  <div class="pop-conts">
                      <div class="btn-r">
                          <a href="#" class="cbtn"><i class="fas fa-times"></i></a>
                      </div>
                      <div class="row">
                        <div class="col-xl-12 col-lg-7">
                          <h6>점검항목 전체 목록</h6>

                          <div class="inputs">
                            점검항목그룹 이름<span class="required"> *</span>
                              <input type="text" class="text-inputs" name="igName">
                          </div>

                          <div class="inputs">
                            점검항목그룹 이름<span class="required"> *</span>
                              <input type="text" class="text-inputs" name="manager">
                          </div>

                          <div class="popup-table" style="text-align: center;">
                          <div class="table-responsive">
                            <ul class="nav nav-tabs manage_list list-tabs" role="tablist">
                              <li class="active">
                                <a href="#" data-toggle="tab" id="all">전체</a>
                              </li>
                              <li class="">
                                <a href="#" data-toggle="tab" id="OS">OS</a>
                              </li>
                              <li class="">
                                <a href="#" data-toggle="tab" id="DBMS">DBMS</a>
                              </li>
                              <li class="">
                                <a href="#" data-toggle="tab" id="WEB">WEB/WAS</a>
                              </li>
                              <li class="">
                                <a href="#" data-toggle="tab" id="Network">Network</a>
                              </li>
                              <li class="">
                                <a href="#" data-toggle="tab" id="gear">보안장비</a>
                              </li>
                              <li class="">
                                <a href="#" data-toggle="tab" id="manages">관리보안</a>
                              </li>
                              <li class="">
                                <a href="#" data-toggle="tab" id="private">개인정보보호</a>
                              </li>
                            </ul>
                            <table class="table table-bordered" id="ManageObjects_dataTable" width="100%" cellspacing="0">
                              <thead>
                              <tr>
                                <th><input type="checkbox" id="check_all2"></th>
                                <th>유형</th>
                                <th>이름</th>
                                <th>용도</th>
                                <th>담당조직</th>
                                <th>운영부서1</th>
                                <th>운영부서2</th>
                                <th>IP주소</th>
                                <th>위치정보</th>
                              </tr>
                              </thead>
                              <tbody></tbody>
                            </table>
                            <a href="#" class="btn btn-primary btn-icon-split" id="add_objs" style="margin-bottom: 20px;">
                              <span class="text" id="insert_ig">점검항목그룹 생성</span>
                            </a>
                          </div>
                        </div>
                        </div>
                      </div>
                  </div>
              </div>
          </div>
      </div>
      <!-- 레이어 팝업 end -->

        </div>
        <!-- /.container-fluid -->

      </div>
      <!-- End of Main Content -->

      <!-- Footer -->
      <footer class="sticky-footer bg-white">
        <div class="container my-auto">
          <div class="copyright text-center my-auto">
            <span>Copyright &copy; Your Website 2020</span>
          </div>
        </div>
      </footer>
      <!-- End of Footer -->

    </div>
    <!-- End of Content Wrapper -->

  </div>
  <!-- End of Page Wrapper -->

  <th:block th:include="fragment/footer"></th:block>

  <script>

    function layer_open(el){
      var temp = $('#' + el);

      $('.layer').fadeIn();	//'bg' 클래스가 존재하면 레이어가 나타나고 배경은 dimmed 된다.
      temp.fadeIn();

      // 화면의 중앙에 레이어를 띄운다.
      if (temp.outerHeight() < $(document).height() ) temp.css('margin-top', '-'+temp.outerHeight()/2+'px');
      else temp.css('top', '0px');
      if (temp.outerWidth() < $(document).width() ) temp.css('margin-left', '-'+temp.outerWidth()/2+'px');
      else temp.css('left', '0px');
      temp.show();

      temp.find('a.cbtn').click(function(e){
          e.preventDefault();
          $('.layer').fadeOut(); //'bg' 클래스가 존재하면 레이어를 사라지게 한다.
          temp.fadeOut().hide();
      });

      $('.layer .bg').click(function(e){	//배경을 클릭하면 레이어를 사라지게 하는 이벤트 핸들러
          e.preventDefault();
          $('.layer').fadeOut();
          $('.pop-layer').hide();
      });
    }

    function Change_tables(search){
      $('#ManageObjects_dataTable').DataTable( {
        destroy: true,
          search:search,
        ajax : {
         type : "POST",
         url : "getObjectDatatable.do",
        },
          language : lang_kor,
          ordering : false,
          scrollX : "100%",
          sScrollXInner: "1150px",
          dom: "<'row'<'col-xl-12 col-lg-7 no-padding'lfrBtip>>"+"",
          columns : [
              {
                  data : "oid",
                  defaultContent:"",
                  'targets': 0,
                  'searchable': false,
                  'className':'dt-2',
                  "render": function (data) {
                      return '<input type="checkbox" name="MeasureChecked" data-oid="'+data+'" value="'+data+'" class="checked">';
                  }
                  },
              {data : "type", 'className': ''},
              {data : "oname", 'className':'dt-10'},
              {data : "purpose", 'className':'dt-16'},
              {data : "ogroup", 'className':'dt-16'},
              {data : "part1"},
              {data : "part2"},
              {data : "ip"},
              {data : "location", 'orderable': false, 'className': 'dt-6'},
        ],
      });
  }

  var lang_kor = {
        "decimal" : "",
        "emptyTable" : "데이터가 없습니다.",
        "info" : "_START_ - _END_ (총 _TOTAL_ 건)",
        "infoEmpty" : "0건",
        "infoFiltered" : "(전체 _MAX_ 명 중 검색결과)",
        "infoPostFix" : "",
        "thousands" : ",",
        "lengthMenu" : "_MENU_ 개씩 보기",
        "loadingRecords" : "로딩중...",
        "processing" : "처리중...",
        "search" : "검색 : ",
        "zeroRecords" : "점검항목이 없습니다.",
        "paginate" : {
            "first" : "첫 페이지",
            "last" : "마지막 페이지",
            "next" : "다음",
            "previous" : "이전"
        },
        "aria" : {
            "sortAscending" : " :  오름차순 정렬",
            "sortDescending" : " :  내림차순 정렬"
        }
    };

    function insertInspectGroup(objects) {

      $.ajax({
        url : "insertInspectGroup.do",
        type : "POST",
        dataType : "json",
        data : {
            'iid' : 0,
            'igName'   : $('input[name="igName"]').val(),
            'objects' : objects,
            'manager'    : $('input[name="manager"]').val(),
        },
          success:function(data) {
            swal({
                'title' : '완료!',
                'text' : '점검항목그룹 생성을 완료하였습니다.',
                'icon' : 'success'
            }, function() {
                location.reload();
            });
        }

      });

    }

    $(document).ready(function() {

      $('#ig_reg').click(function(e) {
        e.preventDefault();
        layer_open("layer1");
      });

      $('#ConfGroup_dataTable').DataTable({
        ajax : {
          type : "POST",
          url : "getInspectGroupDatatable.do",
        },
        language : lang_kor,
        ordering : false,
        scrollX : "100%",
        sScrollXInner: "1000px",
        dom: "<'row'<'col-xl-12 col-lg-7 no-padding'lfrtip>>"+"",
        columns : [
                {
                  data : "cgid",
                  defaultContent:"",
                  'targets': 0,
                  'searchable': false,
                  'className':'dt-2',
                  "render": function (data) {
                    return '<input type="checkbox" name="MeasureChecked" data-igid="'+data+'" value="'+data+'" class="checked">';
                  }
                  },
          {data : "igName", 'className': ''},
          {data : "manager", 'className': ''},
        ],
      });

      $('#ManageObjects_dataTable').DataTable( {
       ajax : {
         type : "POST",
         url : "getObjectDatatable.do",
       },
       language : lang_kor,
       ordering : false,
       scrollX : "100%",
       sScrollXInner: "1150px",
       dom: "<'row'<'col-xl-12 col-lg-7 no-padding'lfrBtip>>"+"",
       columns : [
         {
           data : "oid",
           defaultContent:"",
           'targets': 0,
           'searchable': false,
           'className':'dt-2',
           "render": function (data) {
             return '<input type="checkbox" name="MeasureChecked" data-oid="'+data+'" value="'+data+'" class="checked">';
           }
         },
         {data : "type", 'className': ''},
         {data : "oname", 'className':'dt-10'},
         {data : "purpose", 'className':'dt-16'},
         {data : "ogroup", 'className':'dt-16'},
         {data : "part1"},
         {data : "part2"},
         {data : "ip"},
         {data : "location", 'orderable': false, 'className': 'dt-6'},
        ],
      });

      $('#insert_ig').click(function(e) {

        var oid = [];

        $('input[name="MeasureChecked"]:checked').each(function() {
          oid.push($(this).val());
        });

        var objects = oid.join(", ");

        console.log(objects);

        insertInspectGroup(objects);

      });

    });
  </script>
