<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
  <th:block th:include="fragment/header"></th:block>

    <!-- Content Wrapper -->
    <div id="content-wrapper" class="d-flex flex-column">

      <!-- Main Content -->
      <div id="content">
        <th:block th:include="fragment/nav"></th:block>

        <!-- Begin Page Content -->
        <div class="container-fluid">

          <!-- Page Heading -->
          <div class="col-xl-12 col-lg-7 no-padding">
               <div class="card shadow mb-4">
                  <div class="card-body">
                      <h1 class="h3 mb-2 text-gray-800">점검항목 현황</h1>
                      <p>점검항목관리를 통해 항목을 등록하고 삭제할 수 있습니다.</p>
                  </div>
              </div>
          </div>

          <div class="row">
            <div class="col-xl-12 col-lg-7">
            <!-- DataTales Example -->
              <div class="card shadow mb-4">
              <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                <h6 class="m-0 font-weight-bold text-primary">점검항목 목록</h6>
                <div class="dropdown no-arrow">
                  <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                  </a>
                  <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in" aria-labelledby="dropdownMenuLink">
                    <div class="dropdown-header">점검항목 관리:</div>
                    <a class="dropdown-item" href="#" id="object_reg"><i class="fas fa-plus"></i> 점검항목 등록</a>
                    <a class="dropdown-item" href="#" id="object_del"><i class="fas fa-minus-square"></i> 점검항목 삭제</a>
                  </div>
                </div>
              </div>
              <div class="card-body">
                <select class="table-filter" id="table-filter">
                  <option value="보안관리">보안관리</option>
                  <option value="김지호">김지호</option>
                </select>
                <select class="table-filter" id="table-filter-2">
                  <option value="보안관리">보안관리</option>
                  <option value="김지호">김지호</option>
                </select>
                <div class="table-responsive">
                  <table class="table table-bordered ManageConfluence" id="ManageConfluence_dataTable" width="100%" cellspacing="0">
                    <thead>
                    <tr>
                      <th class="check"><input type="checkbox" id="check_all"></th>
                      <th class="confCategory">분류</th>
                      <th class="name">항목명</th>
                      <th class="danger">위험도</th>
                      <th class="require">요구수준</th>
                    </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
            </div>
            </div>
          </div> <!-- end of row-->

        </div>
        <!-- /.container-fluid -->
        <!-- 레이어 팝업 -->
      <div class="layer" id="manage_obj_popup">
          <div class="bg"></div>
          <div id="layer1" class="pop-layer" style="display: none; width: 800px;">
              <div class="pop-container">
                  <div class="pop-conts">
                      <div class="btn-r">
                          <a href="#" class="cbtn"><i class="fas fa-times"></i></a>
                      </div>
                      <div class="row">
                        <h6>점검항목 등록</h6>
                          <div class="reg-contents">
                            <form action="/register_conf" method="post">
                            <div class="inputs">
                              항목 유형 선택 <span class="required"> *</span><hr>
                              <select class="second" name="type">
                                <option value="">선택하세요</option>
                                <option value="보안관리">보안관리</option>
                                <option value="Web/Mob 점검">Web/Mob 점검</option>
                              </select>
                              <select class="second" name="type">
                                <option value="">선택하세요</option>
                                <option value="보안관리">보안관리</option>
                                <option value="Web/Mob 점검">Web/Mob 점검</option>
                              </select>
                            </div> <!-- end of inputs -->

                            <div class="inputs">
                              <div class="subtitle">점검항목분류<span class="required"> *</span></div>
                              <div class="contents">
                                <label for="cat_OS" class="btn btn-info btn-icon-split btn-sm cat_OS cat_btn">
                                  <span class="text">OS</span>
                                  </label>
                                  <input type="radio" name="confCategory" id="cat_OS" value="OS">

                                  <label for="cat_DBMS" class="btn btn-info btn-icon-split btn-sm cat_DBMS cat_btn">
                                      <span class="text">DBMS</span>
                                  </label>
                                  <input type="radio" name="confCategory" id="cat_DBMS" value="DBMS">

                                  <label for="cat_WEB" class="btn btn-info btn-icon-split btn-sm cat_WEB cat_btn">
                                      <span class="text">WEB</span>
                                  </label>
                                  <input type="radio" name="confCategory" id="cat_WEB" value="WEB">

                                  <label for="cat_Network" class="btn btn-info btn-icon-split btn-sm cat_Network cat_btn">
                                      <span class="text">Network</span>
                                  </label>
                                  <input type="radio" name="confCategory" id="cat_Network" value="Network">

                                  <label for="cat_gear" class="btn btn-info btn-icon-split btn-sm cat_gear cat_btn">
                                      <span class="text">보안장비</span>
                                  </label>
                                  <input type="radio" name="confCategory" id="cat_gear" value="보안장비">

                                  <label for="cat_manage" class="btn btn-info btn-icon-split btn-sm cat_manage cat_btn">
                                      <span class="text">관리보안</span>
                                  </label>
                                  <input type="radio" name="confCategory" id="cat_manage" value="관리보안">

                                  <label for="cat_private" class="btn btn-info btn-icon-split btn-sm cat_private cat_btn">
                                      <span class="text">개인정보보호</span>
                                  </label>
                                  <input type="radio" name="confCategory" id="cat_private" value="개인정보보호">
                              </div>
                            </div>

                            <div class="inputs">
                              <div class="subtitle">점검항목명<span class="required"> *</span></div>
                              <div class="contents">
                                <input type="text" class="full" name="cName">
                              </div>
                            </div>

                            <div class="inputs">
                              <div class="subtitle">점검항목내용<span class="required"> *</span></div>
                              <div class="contents">
                                <input type="text" class="full" name="content">
                              </div>
                            </div>

                            <div class="inputs">
                              <div class="subtitle">위험도<span class="required"> *</span></div>
                              <div class="contents">
                                <select class="first" name="risk">
                                  <option value="">선택하세요</option>
                                  <option value="High">High</option>
                                  <option value="Medium">Medium</option>
                                  <option value="Low">Low</option>
                                </select>
                              </div>
                            </div>

                            <div class="inputs">
                              <div class="subtitle">요구수준<span class="required"> *</span></div>
                              <div class="contents">
                                <input type="text" class="full" name="demand">
                              </div>
                            </div>

                            <div class="inputs">
                              <div class="subtitle">준수기준<span class="required"> *</span></div>
                              <div class="contents">
                                <textarea name="comply"></textarea>
                              </div>
                            </div>

                            <div class="inputs">
                              <div class="subtitle">지침 및 메뉴얼<span class="required"> *</span></div>
                              <div class="contents">
                                <textarea name="manual"></textarea>
                              </div>
                            </div>
                              <input type="submit" value="등록하기">
<!--                            <a href="" class="btn btn-primary btn-icon-split">-->
<!--                              <span class="icon text-white-50">-->
<!--                                <i class="fas fa-check"></i>-->
<!--                              </span>-->
<!--                              <span class="text">등록하기</span>-->
<!--                            </a>-->
                              </form>
                          </div> <!-- end of reg-contents -->

                      </div>
                  </div>
              </div>
          </div>

        <div id="layer2" class="pop-layer" style="display: none; width: 800px;">
              <div class="pop-container" style="overflow: none;">
                  <div class="pop-conts">
                      <div class="btn-r">
                          <a href="#" class="cbtn"><i class="fas fa-times"></i></a>
                      </div>
                      <div class="row">
                        <div class="card shadow mb-4" style="width: 100%">
                          <div class="card-header">SRV-006. Sendmail Log Level 미설정</div>
                          <div class="card-body">
                            <ul class="nav nav-tabs confluence_detail" role="tablist">
                              <li class="active">
                                <a href="#" data-toggle="tab" id="contents">점검항목 내용</a>
                              </li>
                              <li class="">
                                <a href="#" data-toggle="tab" id="guide">준수기준</a>
                              </li>
                              <li class="">
                                <a href="#" data-toggle="tab" id="manual">지침 및 메뉴얼</a>
                              </li>
                            </ul>
                            <div class="content-box">
                              <div class="inners contents active">
                                o SMTP 서비스는 인터넷에서 메일을 전송하는 SMTP 프로토콜을 기반으로 하는 서비스로,
                              악의적인 공격자는 SMTP 서비스를 이용하여 SMTP 서비스를 실행 중인 컴퓨터의 정보를 획득하거나 다양한 공격이 가능하므로
                              불필요한 SMTP 서비스 가동 여부를 점검
                              </div>
                              <div class="inners guide">
                                준수기준은?
                              </div>
                              <div class="inners manual">
                                지침 및 메뉴얼입니당
                              </div>

                            </div>
                        </div>
                      </div>
                    </div>
                  </div>
              </div>
        </div>
      </div>
      <!-- 레이어 팝업 end -->

      </div>
      <!-- End of Main Content -->

      <!-- Footer -->
      <footer class="sticky-footer bg-white">
        <div class="container my-auto">
          <div class="copyright text-center my-auto">
            <span>Copyright &copy; Your Website 2020</span>
          </div>
        </div>
      </footer>
      <!-- End of Footer -->

    </div>
    <!-- End of Content Wrapper -->

  </div>
  <!-- End of Page Wrapper -->

  <th:block th:include="fragment/footer"></th:block>

  <script>

    var lang_kor = {
        "decimal" : "",
        "emptyTable" : "데이터가 없습니다.",
        "info" : "_START_ - _END_ (총 _TOTAL_ 건)",
        "infoEmpty" : "0건",
        "infoFiltered" : "(전체 _MAX_ 명 중 검색결과)",
        "infoPostFix" : "",
        "thousands" : ",",
        "lengthMenu" : "_MENU_ 개씩 보기",
        "loadingRecords" : "로딩중...",
        "processing" : "처리중...",
        "search" : "검색 : ",
        "zeroRecords" : "검색된 데이터가 없습니다.",
        "paginate" : {
            "first" : "첫 페이지",
            "last" : "마지막 페이지",
            "next" : "다음",
            "previous" : "이전"
        },
        "aria" : {
            "sortAscending" : " :  오름차순 정렬",
            "sortDescending" : " :  내림차순 정렬"
        }
    };

    var buttons = [
            {
                extend: 'excel',
                className: 'btn-success'
            },
            {
                extend: 'copy',
                className: 'btn-primary'
            },
            {
                extend: 'csv',
                className: 'btn-warning'
            },
            {
                extend: 'pdf',
                className: 'btn-danger'
            },
        ];

    function layer_open(el){
      var temp = $('#' + el);

      $('.layer').fadeIn();	//'bg' 클래스가 존재하면 레이어가 나타나고 배경은 dimmed 된다.
      temp.fadeIn();

      // 화면의 중앙에 레이어를 띄운다.
      if (temp.outerHeight() < $(document).height() ) temp.css('margin-top', '-'+temp.outerHeight()/2+'px');
      else temp.css('top', '0px');
      if (temp.outerWidth() < $(document).width() ) temp.css('margin-left', '-'+temp.outerWidth()/2+'px');
      else temp.css('left', '0px');
      temp.show();

      temp.find('a.cbtn').click(function(e){
          e.preventDefault();
          $('.layer').fadeOut(); //'bg' 클래스가 존재하면 레이어를 사라지게 한다.
          temp.fadeOut().hide();
      });

      $('.layer .bg').click(function(e){	//배경을 클릭하면 레이어를 사라지게 하는 이벤트 핸들러
          e.preventDefault();
          $('.layer').fadeOut();
          $('.pop-layer').hide();
      });
    }

    function DeleteObject(checked) {
      swal({
        'title' : '',
        'text' : '삭제가 완료되었습니다.',
      });
    }

    $(document).ready(function() {

      var table = $('#ManageConfluence_dataTable').DataTable( {
        ajax : {
          type : "POST",
          url : "getConfDatatable.do",
        },
        destroy : true,
        language : lang_kor,
        ordering : false,
        scrollX : "100%",
        sScrollXInner: "1150px",
        dom: "<'row'<'col-xl-12 col-lg-7 no-padding'lfrtip>>"+"",
        columnDefs: [{
          className: "name",
          "targets": [ 2 ]
        }],
        columns : [
                {
                  data : "cid",
                  defaultContent:"",
                  'targets': 0,
                  'searchable': false,
                  'className':'dt-2',
                  "render": function (data) {
                    return '<input type="checkbox" name="MeasureChecked" data-cid="'+data+'" value="'+data+'" class="checked">';
                  }
                  },
          {data : "type", 'className' : 'dt-25'},
          {data : "cname", 'className' : 'cname'},
          {data : "risk", 'className' : ''},
          {data : "demand", 'className' : ''},
        ],

      });

      $('.table-filter').on('change', function(){
         table.search(this.value).draw();
      });

      $('#ManageConfluence_dataTable td.cname').click(function(e){
        e.preventDefault();
        layer_open('layer2');
      });

      $('#check_all').on('change',function() {
        var checked = $(this).is(':checked');
        if(checked) {
          $('.checked').prop('checked',true);
        } else {
          $('.checked').prop('checked',false);
        }
      });

      $('#object_reg').click(function(e) {
        e.preventDefault();
        layer_open("layer1");
      });

      $('#object_del').click(function(e) {
        e.preventDefault();

        var checkBoxArr = [];

        $('input[name="MeasureChecked"]:checked').each(function() {
          checkBoxArr.push($(this).val());
        });

        if(checkBoxArr.length < 1) {
          swal({
            'title' : '',
            'text' : '삭제할 항목을 선택해주세요.',
            'type' : 'warning',
          });
        } else {
          swal({
              title : '점검항목 삭제',
              text : '선택한 점검항목을 삭제하시겠습니까?',
              type : "warning",
              showCancelButton : true,
              confirmButtonClass : "btn-danger",
              confirmButtonText : "삭제",
              cancelButtonText : "아니오",
          }, function(isConfirm) {
              if(isConfirm) {
                DeleteObject(checkBoxArr);
              }
          });
        }

      });

      $('input[name="confCategory"]').click(function(e) {
        e.preventDefault();
        var checked_id = $(this).attr('id');
        var label = $('label.' + checked_id);
        $('label.cat_btn').removeClass('btn-primary').addClass('btn-info');
        label.removeClass('btn-info').addClass('btn-primary');
      });

      $('ul.confluence_detail li').click(function(){
        $(this).addClass('active');
        $(this).siblings().removeClass('active');
        var c_id = $(this).children().attr('id');
        $('.content-box .inners').removeClass('active');
        $('.content-box .'+c_id).addClass('active');
      });

    });
  </script>
